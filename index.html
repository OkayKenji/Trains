<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fetch JSON Example</title>
    <style>
        th {
        position: sticky;
        top: 0px;  
        z-index: 1;
        background: white;
        }

        .aaaaaaaaa {
        position: sticky;
        left: 0px;  
        z-index: 0;
        background: white;
        }
    </style>
    <script>
        let global_list;
        let orig_list;
        // Fetch JSON data
        fetch('./json/datamnrr.json')
            .then(response => response.json())
            .then(data => {
                // Log data to console
                const trains = [];


                for (const [key, train] of Object.entries(data)) {
                    const stops = train.stops;
                    trains.push(['never-filter'])

                    for (const property in stops) {
                        trains.push([property])
                    }
                    break;
                }



                for (const train of data) {
                    const stops = train.stops;
                    let index = 0;
                    trains[index].push({
                        train_number: train.train_number,
                        train_line: train.train_line
                    })

                    index++;



                    for (const property in stops) {
                        trains[++index - 1].push(
                            stops[property].departure_time === 'n/a'
                                ? ''
                                : `${stops[property].departure_time} ${stops[property].stop_index}`);
                    }
                }

                const result = clean_table(transpose(transpose(trains).filter((word) => word[0].train_line != "" || word[0] == "never-filter")));

                global_list = result

                createTable();
            })
            .catch(error => console.error('Error fetching JSON:', error));

        function transpose(matrix) {
            return matrix[0].map((_, colIndex) => matrix.map(row => row[colIndex]));
        }


        function clean_table(arr) {
            for (let i = arr.length - 1 ; i >= 0 ; i--) {
                for (let j = 1 ; j <= arr[i].length ; j++ ) {
                    if (j == arr[i].length ) {
                        arr.splice(i,1);
                        break;
                    }

                    if (arr[i][j] !== '' ) {
                        break;
                    }

                }
            }
            return arr;

        }

        function createTable() {
            let data = global_list;
            // Get the table container element
            const tableContainer = document.getElementById('table-container');

            // Create the table
            const table = document.createElement('table');
            table.setAttribute('border', '1'); // Optional: Add border to the table

            // Create the table header
            const thead = document.createElement('thead');
            const headerRow = document.createElement('tr');
            // Add header cells
            const headers = Object.keys(data[0]);
            headers.forEach(header => {
                const th = document.createElement('th');
                th.innerText = data[0][header].train_number ? `${data[0][header].train_line} - ${data[0][header].train_number}` : '';
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);
            table.appendChild(thead);

            // Create the table body
            const tbody = document.createElement('tbody');
            data.slice(1).forEach(item => {
                const row = document.createElement('tr');
                let firstCell = true;
                headers.forEach(header => {
                    
                    const td = document.createElement('td');
                    td.innerText = item[header];
                    if (firstCell) {
                        td.classList.add("aaaaaaaaa");
                        firstCell = false;
                    }
                    row.appendChild(td);
                });
                tbody.appendChild(row);
            });

            table.appendChild(tbody);
            tableContainer.innerText = '';
            tableContainer.appendChild(table);

        }

    </script>
</head>

<body>
    <h1>Trains</h1>
    <pre id="filters"></pre>
    <pre id="table-container">Loading JSON data...</pre> <!-- Display the JSON data here -->
</body>

</html>